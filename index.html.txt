<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Safety Assistant</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- jsPDF for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 text-gray-800">
  <div class="max-w-4xl mx-auto p-6">
    <h1 class="text-4xl font-extrabold mb-8 text-center text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 animate-pulse">Data Safety Assistant</h1>

    <!-- Step 1: Service Selection -->
    <section id="step1" class="bg-white bg-opacity-80 p-6 rounded-2xl shadow-lg transition-transform transform hover:scale-105">
      <h2 class="text-2xl font-semibold mb-4">1. Select SDKs/Services</h2>
      <div class="grid grid-cols-2 gap-4">
        <!-- SDK checkboxes -->
        <label class="flex items-center"><input type="checkbox" class="service-checkbox mr-2" value="unity_ads" />Unity Ads</label>
        <label class="flex items-center"><input type="checkbox" class="service-checkbox mr-2" value="admob" />Google AdMob</label>
        <label class="flex items-center"><input type="checkbox" class="service-checkbox mr-2" value="crashlytics" />Firebase Crashlytics</label>
        <label class="flex items-center"><input type="checkbox" class="service-checkbox mr-2" value="facebook_login" />Facebook Login SDK</label>
        <label class="flex items-center"><input type="checkbox" class="service-checkbox mr-2" value="facebook_analytics" />Facebook Analytics SDK</label>
        <label class="flex items-center"><input type="checkbox" class="service-checkbox mr-2" value="flurry" />Flurry Analytics</label>
        <label class="flex items-center"><input type="checkbox" class="service-checkbox mr-2" value="intercom" />Intercom</label>
        <label class="flex items-center"><input type="checkbox" class="service-checkbox mr-2" value="mixpanel" />Mixpanel</label>
        <label class="flex items-center"><input type="checkbox" class="service-checkbox mr-2" value="stripe" />Stripe SDK</label>
        <label class="flex items-center"><input type="checkbox" class="service-checkbox mr-2" value="iap" />Google Play IAP</label>
      </div>
      <button id="toStep2" class="mt-6 w-full py-2 rounded-2xl bg-gradient-to-r from-blue-500 to-purple-500 text-white font-semibold hover:from-purple-500 hover:to-blue-500 transition-colors">Next</button>
    </section>

    <!-- Step 2: Questionnaire -->
    <section id="step2" class="hidden bg-white bg-opacity-80 p-6 rounded-2xl shadow-lg mt-6 animate-fade-in">
      <h2 class="text-2xl font-semibold mb-4">2. Data Safety Details</h2>
      <div class="overflow-x-auto">
        <table class="min-w-full table-auto">
          <thead>
            <tr class="bg-gradient-to-r from-blue-100 to-purple-100">
              <th class="px-4 py-2">Data Type</th>
              <th class="px-4 py-2">Collected</th>
              <th class="px-4 py-2">Shared</th>
              <th class="px-4 py-2">Processed Ephemerally?</th>
              <th class="px-4 py-2">Required?</th>
              <th class="px-4 py-2">Purposes</th>
            </tr>
          </thead>
          <tbody id="questionForm"></tbody>
        </table>
      </div>
      <div class="mt-6 grid grid-cols-3 gap-4">
        <button id="generate" class="py-2 rounded-2xl bg-green-500 text-white font-semibold hover:bg-green-600 transition-colors">Generate</button>
        <button id="exportCsv" class="py-2 rounded-2xl bg-yellow-500 text-white font-semibold hover:bg-yellow-600 transition-colors">Export CSV</button>
        <button id="exportPdf" class="py-2 rounded-2xl bg-red-500 text-white font-semibold hover:bg-red-600 transition-colors">Export PDF</button>
      </div>
    </section>

    <!-- Step 3: Output -->
    <section id="step3" class="hidden bg-white bg-opacity-80 p-6 rounded-2xl shadow-lg mt-6 animate-fade-in">
      <h2 class="text-2xl font-semibold mb-4">3. Your Data Safety Checklist</h2>
      <pre id="output" class="bg-gray-50 p-4 rounded-lg overflow-x-auto"></pre>
    </section>
  </div>

  <script>
    // Fade-in animation
    const style = document.createElement('style');
    style.innerHTML = '@keyframes fade-in { from { opacity: 0; } to { opacity: 1; } } .animate-fade-in { animation: fade-in 0.5s ease-in; }';
    document.head.appendChild(style);

    const dataTypeMeta = { /* same as before */
      user_ids: {label:'User IDs', collected:true, shared:true, ephemeral:false, required:true, purposes:['Advertising','Analytics']},
      other_info: {label:'Other info', collected:true, shared:true, ephemeral:false, required:false, purposes:['Analytics','Personalization']},
      app_activity: {label:'App activity', collected:true, shared:true, ephemeral:true, required:true, purposes:['Analytics']},
      app_interactions: {label:'App interactions', collected:true, shared:true, ephemeral:true, required:false, purposes:['Advertising']},
      other_actions: {label:'Other actions', collected:true, shared:true, ephemeral:true, required:false, purposes:['Engagement']},
      crash_logs: {label:'Crash logs', collected:true, shared:true, ephemeral:false, required:false, purposes:['Performance']},
      diagnostics: {label:'Diagnostics', collected:true, shared:true, ephemeral:false, required:false, purposes:['Bug fixing']},
      device_ids: {label:'Device or other IDs', collected:true, shared:true, ephemeral:false, required:true, purposes:['Advertising','Fraud prevention']},
      purchase_history: {label:'Purchase history', collected:true, shared:false, ephemeral:false, required:true, purposes:['Functionality']},
      in_app_search_history: {label:'In-app search history', collected:false, shared:false, ephemeral:false, required:false, purposes:[]},
      email_address: {label:'Email address', collected:false, shared:false, ephemeral:false, required:false, purposes:[]},
      approximate_location: {label:'Approximate location', collected:false, shared:false, ephemeral:false, required:false, purposes:[]},
      photos: {label:'Photos', collected:false, shared:false, ephemeral:false, required:false, purposes:[]},
      videos: {label:'Videos', collected:false, shared:false, ephemeral:false, required:false, purposes:[]},
      address: {label:'Address', collected:false, shared:false, ephemeral:false, required:false, purposes:[]},
      contact: {label:'Contact info', collected:false, shared:false, ephemeral:false, required:false, purposes:[]},
      user_payment_info: {label:'User payment info', collected:false, shared:false, ephemeral:false, required:false, purposes:[]}
    };

    const sdkMapping = { /* same as before */
      unity_ads: ['user_ids','other_info','app_activity','app_interactions','crash_logs','diagnostics','device_ids'],
      admob: ['user_ids','other_info','app_activity','app_interactions','other_actions','device_ids'],
      crashlytics: ['crash_logs','app_interactions','user_ids'],
      facebook_login: ['user_ids','device_ids'],
      facebook_analytics: ['user_ids','purchase_history','app_interactions','in_app_search_history','other_info','address','contact'],
      flurry: ['device_ids','app_interactions'],
      intercom: ['email_address','approximate_location','photos','videos','other_actions'],
      mixpanel: ['user_ids','device_ids','app_interactions','other_actions'],
      stripe: ['user_ids','app_interactions','user_payment_info'],
      iap: ['purchase_history']
    };

    function buildTable() {
      const selected = Array.from(document.querySelectorAll('.service-checkbox:checked')).map(cb=>cb.value);
      if(!selected.length) return;
      const types = new Set();
      selected.forEach(s=>sdkMapping[s]?.forEach(t=>types.add(t)));
      const tbody = document.getElementById('questionForm'); tbody.innerHTML = '';
      types.forEach(key=>{
        const m = dataTypeMeta[key]; if(!m) return;
        const tr = document.createElement('tr');
        tr.className='bg-white hover:bg-gray-50';
        const vals = [m.label, m.collected, m.shared, m.ephemeral, m.required, m.purposes.join(', ')];
        vals.forEach((v,i)=>{
          const td = document.createElement('td'); td.className='border px-4 py-2 text-center';
          if(i>0 && typeof v=== 'boolean') {
            const cb = document.createElement('input'); cb.type='checkbox'; cb.disabled=true; cb.checked=v; td.appendChild(cb);
          } else td.textContent=v;
          if(i===0) td.className='border px-4 py-2 text-left';
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }

    document.getElementById('toStep2').addEventListener('click', () => {
      if(!document.querySelectorAll('.service-checkbox:checked').length) return alert('Select at least one SDK');
      buildTable();
      document.getElementById('step1').classList.add('hidden');
      document.getElementById('step2').classList.remove('hidden');
    });

    document.getElementById('generate').addEventListener('click', ()=>{
      document.getElementById('output').textContent = JSON.stringify(
        Array.from(document.querySelectorAll('#questionForm tr')).map(tr=>{
          const [lbl, col, sha, eph, req, purp] = tr.querySelectorAll('td');
          return { dataType: lbl.textContent, collected: col.querySelector('input').checked, shared: sha.querySelector('input').checked, processedEphemerally: eph.querySelector('input').checked, required: req.querySelector('input').checked, purposes: purp.textContent.split(', ').filter(p=>p)};
        })
      ,null,2);
      document.getElementById('step3').classList.remove('hidden');
    });

    // CSV Export
    document.getElementById('exportCsv').addEventListener('click', ()=>{
      const rows = document.querySelectorAll('#questionForm tr');
      const csv = ['Data Type,Collected,Shared,Processed Ephemerally,Required,Purposes'];
      rows.forEach(tr=>{
        const cells = tr.querySelectorAll('td');
        const row = [cells[0].textContent, cells[1].querySelector('input').checked, cells[2].querySelector('input').checked, cells[3].querySelector('input').checked, cells[4].querySelector('input').checked, cells[5].textContent];
        csv.push(row.join(','));
      });
      const blob = new Blob([csv.join('\n')], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='data_safety.csv'; a.click(); URL.revokeObjectURL(url);
    });

    // PDF Export
    document.getElementById('exportPdf').addEventListener('click', async ()=>{
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      let y=10;
      doc.setFontSize(12);
      document.querySelectorAll('#questionForm tr').forEach(tr=>{
        const cells = tr.querySelectorAll('td');
        const line = `${cells[0].textContent}: Collected=${cells[1].querySelector('input').checked}, Shared=${cells[2].querySelector('input').checked}, Ephemeral=${cells[3].querySelector('input').checked}, Required=${cells[4].querySelector('input').checked}, Purposes=${cells[5].textContent}`;
        doc.text(line, 10, y); y+=8;
      });
      doc.save('data_safety.pdf');
    });
  </script>
</body>
</html>
